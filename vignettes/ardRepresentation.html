<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Felipe Toledo Ferreira">
<meta name="dcterms.date" content="2025-07-10">
<meta name="description" content="An approach to functional data representation based on automatic relevance determination.">

<title>Automatic Relevance Determination for Functional Data Representation – Felipe Ferreira</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../FDA logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0383dabcd0d383963fa6a9867e3b47b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="../site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Felipe Ferreira</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../vignettes.html"> 
<span class="menu-text"><tt style="background: #AD1519; color: white;">R</tt> Vignettes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../solutions.html"> 
<span class="menu-text">Solutions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Automatic Relevance Determination for Functional Data Representation</h1>
            <p class="subtitle lead">…a Vignette on Functional Data Analysis</p>
                  <div>
        <div class="description">
          An approach to functional data representation based on automatic relevance determination.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://github.com/FelipeToledoFerreira">Felipe Toledo Ferreira</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 10, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#the-motorcycle-data-set" id="toc-the-motorcycle-data-set" class="nav-link" data-scroll-target="#the-motorcycle-data-set">The Motorcycle data set</a></li>
  <li><a href="#the-canadian-weather-data-set" id="toc-the-canadian-weather-data-set" class="nav-link" data-scroll-target="#the-canadian-weather-data-set">The Canadian weather data set</a></li>
  <li><a href="#simulated-data" id="toc-simulated-data" class="nav-link" data-scroll-target="#simulated-data">Simulated data</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#automatic-relevance-determination" id="toc-automatic-relevance-determination" class="nav-link" data-scroll-target="#automatic-relevance-determination">Automatic Relevance Determination</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#applications-and-simulations" id="toc-applications-and-simulations" class="nav-link" data-scroll-target="#applications-and-simulations">Applications and Simulations</a>
  <ul class="collapse">
  <li><a href="#sec-app-mcycle" id="toc-sec-app-mcycle" class="nav-link" data-scroll-target="#sec-app-mcycle">Application I</a></li>
  <li><a href="#application-ii" id="toc-application-ii" class="nav-link" data-scroll-target="#application-ii">Application II</a></li>
  <li><a href="#simulation-study-i" id="toc-simulation-study-i" class="nav-link" data-scroll-target="#simulation-study-i">Simulation Study I</a></li>
  <li><a href="#simulation-study-ii" id="toc-simulation-study-ii" class="nav-link" data-scroll-target="#simulation-study-ii">Simulation Study II</a></li>
  </ul></li>
  <li><a href="#concluding-remarks" id="toc-concluding-remarks" class="nav-link" data-scroll-target="#concluding-remarks">Concluding Remarks</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">






<div class="no-row-height column-margin column-container"><div class="">
<p>Last updated 2025/07/10.</p>
</div></div><section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<section id="data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>For this particular study, we consider two distinct data sets, the Motorcycle data set and the Canadian weather data set: the former is frequently studied in the overall spline smoothing context (as well as overall studies in Nonparametric Statistics), whilst the latter is most often used in the specific context of Functional Data Analysis. We will also present a brief simulation study. The <tt>R</tt> chunk provided below loads the relevant packages utilized throughout.</p>
<div class="cell">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)  <span class="do">## R package for tidy data manipulation and visualization</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"extrafont"</span>)  <span class="do">## R package for using nice fonts in figures</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"fda"</span>)        <span class="do">## R package for functional data analysis</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"MASS"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"magrittr"</span>)   <span class="do">## R package for pipes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"patchwork"</span>)  <span class="do">## R package for plot composition</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"reshape2"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rstan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="the-motorcycle-data-set" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="the-motorcycle-data-set">The Motorcycle data set</h3>
<p>The Motorcycle data set (seen in <span class="citation" data-cites="silverman:1985">Silverman (<a href="#ref-silverman:1985" role="doc-biblioref">1985</a>)</span>, and available in the <tt>R</tt> programming language in the package <tt>MASS</tt>) consists of <span class="math inline">\(n = 133\)</span> measurements obtained through an experiment which simulated motorcycle accidents with the goal of determining the efficacy of crash helmets: an accelerometer was fitted to an object which was later submitted to repeated mechanical impacts, and the resulting acceleration was measured in the instants subsequent to the impacts. We denote the measurements of the time (in milliseconds) elapsed since the impact occurs as <span class="math inline">\(t_j\)</span>, and the acceleration (in g) measured at the corresponding instant as <span class="math inline">\(y_j\)</span>, hence we denote the full data set as <span class="math inline">\(\{t_j, y_j\}^n_{j = 1}\)</span>. Some observations can be made with respect to the set of instants <span class="math inline">\(\{t_j\}^n_{j = 1}\)</span>: as the data set was gathered through repeat experiments, the measured instants are not equally spaced, and some appear multiple times (with distinct corresponding <span class="math inline">\(y_j\)</span>). Let <span class="math inline">\(Y_j\)</span> denote a random variable corresponding to the <span class="math inline">\(j\)</span>-th accelerometer measurement, we assume that</p>
<p><span id="eq-expectation"><span class="math display">\[
  \mathbb{E}[Y_j] = g(t_j) \quad j \in \{1,\ldots,n\}.
\tag{1}\]</span></span></p>
<p>That is, we assume that albeit the accelerometer measurements are randomly distributed, they present some regularity in the form of a mean, which is dependent on the instant at which the measurement is made, expressed as the mean function <span class="math inline">\(g(\cdot)\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. In particular, we’ll assume that <span class="math inline">\(Y_j \sim \text{Normal}(g(t_j), 1/\tau)\)</span>, <span class="math inline">\(\tau &gt; 0\)</span>, or equivalently</p>
<p><span id="eq-decomposition"><span class="math display">\[
  y_j = g(t_j) + \tau^{-1/2}\varepsilon_j \quad j \in \{1,\ldots,n\},
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(\varepsilon_j \sim \text{Normal}(0,1), j \in \{1,\ldots,n\}\)</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. The first term on the r.h.s. of <a href="#eq-decomposition" class="quarto-xref">Equation&nbsp;2</a> is the ‘<em>deterministic component</em>’, whilst the second term on the r.h.s. of <a href="#eq-decomposition" class="quarto-xref">Equation&nbsp;2</a> is the ‘<em>stochastic component</em>’. Our goal is to construct an estimator <span class="math inline">\(\hat{g}(\cdot)\)</span> for the deterministic component. Naturally, searching for an optimal <span class="math inline">\(\hat{g}(\cdot) \in \mathcal{G}\)</span>, where <span class="math inline">\(\mathcal{G}\)</span> is an arbitrary functional space (e.g.&nbsp;the space of square integrable functions) is computationally unfeasible, as <span class="math inline">\(\mathcal{G}\)</span> would likely be infinite-dimensional. For that purpose, first we will assume that <span class="math inline">\(g(\cdot)\)</span> may be written as the linear combination of a set of basis functions <span class="math inline">\(\{\phi_k(\cdot)\}_{k = 1}^{K}\)</span> of the following form</p>
<p><span id="eq-expansion"><span class="math display">\[
  g(t) = \sum^K_{k = 1}\beta_{k} \phi_k(t),
\tag{3}\]</span></span></p>
<p>for some <span class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^{K}\)</span>. This allows us to recontextualize the usually infinite-dimensional problem of estimating <span class="math inline">\({g}(\cdot) \in \mathcal{G}\)</span> as a finite-dimensional problem of estimating <span class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^K\)</span>. Ideally, the set of basis functions <span class="math inline">\(\{\phi_k(\cdot)\}_{k = 1}^K\)</span> would be chosen so as to both reflect properties we believe the function <span class="math inline">\(g(\cdot)\)</span> possesses (e.g., continuity to the <span class="math inline">\(M\)</span>-th order) and to provide a sufficiently flexible foundation which may approximate several distinct forms of <span class="math inline">\(g(\cdot)\)</span> (there are also data-driven choices for basis functions, such as via functional principal components analysis). A natural choice for a set of basis functions are those generated in the B-spline framework (see <span class="citation" data-cites="deBoor:1978">De Boor (<a href="#ref-deBoor:1978" role="doc-biblioref">1978</a>)</span>). In particular, we’ll consider cubic B-splines with equidistant knots (with the first knot defined as <span class="math inline">\(\min_j\{t_j\}\)</span> and the last knot as <span class="math inline">\(\max_j\{t_j\}\)</span>), such that the number of basis functions in a basis set is <span class="math inline">\(K\)</span> (including boundary B-splines), with <span class="math inline">\(K \in \{5,10,15,20,25,30\}\)</span>. Let <span class="math inline">\(\boldsymbol{\Phi} \in \mathbb{R}^{K \times K}\)</span> and <span class="math inline">\(\boldsymbol{\phi}(t) \in \mathbb{R}^K\)</span> be defined as <span id="eq-matrix"><span class="math display">\[
  \boldsymbol{\Phi} = \begin{pmatrix}
    \phi_{1}(t_1) &amp; \phi_{2}(t_1) &amp; \dots &amp; \phi_{K}(t_1) \\
    \phi_{1}(t_2) &amp; \phi_{2}(t_2) &amp; \dots &amp; \phi_{K}(t_2) \\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    \phi_{1}(t_n) &amp; \phi_{2}(t_n) &amp; \dots &amp; \phi_{K}(t_n)
  \end{pmatrix} \quad \text{and} \quad \boldsymbol{\phi}(t) = \begin{pmatrix}
    \phi_1(t) \\
    \phi_2(t) \\
    \vdots \\
    \phi_K(t)
  \end{pmatrix},
\tag{4}\]</span></span> we determine the estimates for the coefficients <span class="math inline">\(\boldsymbol{\beta}\)</span> via maximum likelihood estimation as <span class="math display">\[
  \begin{aligned}
    \hat{\boldsymbol{\beta}}_\text{ML} &amp; = \arg \max_{\boldsymbol{\beta}\in\mathbb{R}^K} \Bigg\{-\frac{n}{2}\ln(2 \pi) + \frac{n}{2} \ln(\tau) -\frac{\tau}{2}\sum^n_{j = 1}(y_j - \boldsymbol{\beta}^\top \boldsymbol{\phi}(t_j))^2 \Bigg\} \\
    &amp; = \arg \min_{\boldsymbol{\beta} \in \mathbb{R}^K} \Bigg\{\sum^n_{j = 1}(y_j - \boldsymbol{\beta}^\top \boldsymbol{\phi}(t_j))^2\Bigg\} \\
    \hat{\boldsymbol{\beta}}_\text{ML} &amp; = (\boldsymbol{\Phi}^\text{T} \boldsymbol{\Phi})^{-1}\boldsymbol{\Phi}^\text{T}\mathrm{y},
  \end{aligned}
\]</span> assuming <span class="math inline">\(\boldsymbol{\Phi}^\text{T}\boldsymbol{\Phi}\)</span> is positive-definite. Therefore, the estimated mean function <span class="math inline">\(\hat{g}(\cdot)\)</span> evaluated at a point <span class="math inline">\(s\)</span> is defined as <span class="math display">\[
  \hat{g}(s) = \boldsymbol{\hat{\beta}}^\text{T}_{\text{ML}} \boldsymbol{\phi}(s).
\]</span> <a href="#fig-mcycle" class="quarto-xref">Figure&nbsp;1</a> illustrates the estimated mean functions <span class="math inline">\(\hat{g}(\cdot)\)</span> obtained via maximum likelihood for each <span class="math inline">\(K\)</span>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb2" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">747</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>eval_x <span class="ot">=</span> mcycle <span class="sc">%&gt;%</span> {<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(.<span class="sc">$</span>times), <span class="at">to =</span> <span class="fu">max</span>(.<span class="sc">$</span>times), <span class="at">length.out =</span> <span class="fl">1e3</span> <span class="sc">+</span> <span class="dv">1</span>)}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mcycle_fda <span class="ot">=</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(K),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>           design_basis <span class="ot">=</span> <span class="fu">create.bspline.basis</span>(<span class="at">rangeval =</span> <span class="fu">range</span>(mcycle<span class="sc">$</span>times),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">norder =</span> <span class="dv">4</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">nbasis =</span> K[x])</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>           design_matrix <span class="ot">=</span> design_basis <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> mcycle<span class="sc">$</span>times,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basisobj =</span> .,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>           design_matrixf <span class="ot">=</span> design_basis <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> eval_x,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basisobj =</span> .,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>           coefficients <span class="ot">=</span> design_matrix <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>             {<span class="fu">solve</span>(<span class="at">a =</span> <span class="fu">t</span>(.) <span class="sc">%*%</span> .,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">b =</span> <span class="fu">t</span>(.) <span class="sc">%*%</span> mcycle<span class="sc">$</span>accel)}</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>           <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">K =</span> K[x],</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">design_matrix =</span> design_matrix,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">design_matrixf =</span> design_matrixf,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coefficients =</span> coefficients,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fitted_values =</span> design_matrix <span class="sc">%*%</span> coefficients,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eval_values =</span> design_matrixf <span class="sc">%*%</span> coefficients))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>           })</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>(<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(K),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">values =</span> mcycle_fda[[x]]<span class="sc">$</span>eval_values,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eval_x =</span> eval_x,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">factor</span>(K[x],</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> K))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> {<span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .)} <span class="sc">%&gt;%</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> .,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> values,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> x,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> x)) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Time after impact (in "</span>, <span class="fu">italic</span>(<span class="st">"ms"</span>), <span class="st">")"</span>)),</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Acceleration (in "</span>, <span class="fu">italic</span>(<span class="st">"g"</span>), <span class="st">")"</span>)),</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">substitute</span>(<span class="fu">italic</span>(K))) <span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>               <span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  (mcycle <span class="sc">|&gt;</span> <span class="fu">geom_point</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> times,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> accel)))) <span class="sc">/</span> <span class="fu">guide_area</span>() <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">4</span>, .<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-mcycle" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mcycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-mcycle-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mcycle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Estimated mean functions for the Motorcycle data set, for <span class="math inline">\(K \in \{5,10,15,20,25,30\}\)</span>. The black dots represent the sampled data, and the dashed red line is represents to <span class="math inline">\(y = 0\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Some remarks can be made with respect to the results of <a href="#fig-mcycle" class="quarto-xref">Figure&nbsp;1</a>: first, we note that for small <span class="math inline">\(K\)</span> (say <span class="math inline">\(K \in \{5,10\}\)</span>), the estimated mean function <span class="math inline">\(\hat{g}(\cdot)\)</span> underfits the data, and is unable to capture localized trends. By contrast, for large <span class="math inline">\(K\)</span> (say <span class="math inline">\(K \in \{25,30\}\)</span>), the estimated mean function overfits the data, extrapolating trends which are potentially spurious. This behavior is expected, and is well known in Statistics as the ‘<em>bias-variance tradeoff</em>’. A more interesting remark can be made after we observe <a href="#fig-mcycle-coef" class="quarto-xref">Figure&nbsp;2</a>, which illustrates the estimated coefficient values <span class="math inline">\(\{\hat{\boldsymbol{\beta}}_\text{ML}\}_k\)</span> for each <span class="math inline">\(K\)</span>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb3" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>coef_plots <span class="ot">=</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(K),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>           g <span class="ot">=</span> mcycle_fda[[x]] <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>             {<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq_along</span>(.<span class="sc">$</span>coefficients),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> .<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> K[x], <span class="at">by =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Basis index ("</span>, <span class="fu">italic</span>(k), <span class="st">")"</span>)),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Estimated coefficient ("</span>, <span class="fu">hat</span>(beta)[k], <span class="st">")"</span>)))}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>           <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">g =</span> g))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>         })</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">1</span>]]<span class="sc">$</span>g <span class="sc">/</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">2</span>]]<span class="sc">$</span>g <span class="sc">/</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">3</span>]]<span class="sc">$</span>g <span class="sc">/</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">4</span>]]<span class="sc">$</span>g <span class="sc">/</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">5</span>]]<span class="sc">$</span>g <span class="sc">/</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>coef_plots[[<span class="dv">6</span>]]<span class="sc">$</span>g <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">axes =</span> <span class="st">'collect'</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">guides =</span> <span class="st">'collect'</span>) <span class="sc">&amp;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-mcycle-coef" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mcycle-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-mcycle-coef-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mcycle-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Estimated coefficients for basis expansions of the Motorcycle data set, with <span class="math inline">\(K \in \{5,10,15,20,25,30\}.\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is apparent in <a href="#fig-mcycle-coef" class="quarto-xref">Figure&nbsp;2</a>, particularly for larger <span class="math inline">\(K\)</span>, that some coefficients are very close to zero (though they are not zero). Particularly, this occurs to coefficients corresponding to basis functions which model the start of the mean function (around 15<em>ms</em> after impact), and a few of those which model the latter half of the mean function (around 40<em>ms</em> after impact). This yields mean function estimates close to zero (as can be seen in <a href="#fig-mcycle" class="quarto-xref">Figure&nbsp;1</a>)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Though the coefficient estimates may be small, and likewise do not possess statistical or practical significance, they are nevertheless not zero (except in essentially pathological cases). As such, our model would include all <span class="math inline">\(K\)</span> basis functions. A more efficient estimator would automatically identify basis functions whose significance is below a certain threshold and prune those out of the model, yielding a model with only <span class="math inline">\(K_0 \leq K\)</span> non-zero coefficients, with a comparative performance to the full model. Some procedures for automatic variable selection have been developed, which include the Least Absolute Shrinkage and Selection Operator (LASSO; see <span class="citation" data-cites="tibshirani:1996">Tibshirani (<a href="#ref-tibshirani:1996" role="doc-biblioref">1996</a>)</span>), the Smoothly Clipped Absolute Deviation (SCAD; see <span class="citation" data-cites="fan:2001">Fan and Li (<a href="#ref-fan:2001" role="doc-biblioref">2001</a>)</span>), the Minimax Concave Penalty (MCP; see <span class="citation" data-cites="zhang:2010">Zhang (<a href="#ref-zhang:2010" role="doc-biblioref">2010</a>)</span>), the Horseshoe prior (see <span class="citation" data-cites="carvalho:2010">Carvalho, Polson, and Scott (<a href="#ref-carvalho:2010" role="doc-biblioref">2010</a>)</span>) and Automatic Relevance Determination (ARD; see <span class="citation" data-cites="tipping:2001">Tipping (<a href="#ref-tipping:2001" role="doc-biblioref">2001</a>)</span>). In <a href="#sec-app-mcycle" class="quarto-xref">Section&nbsp;2.1</a> of this vignette we illustrate the application of the ARD procedure to the Motorcyle data set.</p>
</section>
<section id="the-canadian-weather-data-set" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="the-canadian-weather-data-set">The Canadian weather data set</h3>
<p>The Canadian weather data set (seen in <span class="citation" data-cites="ramsay:2002">J. O. Ramsay and Silverman (<a href="#ref-ramsay:2002" role="doc-biblioref">2002</a>)</span>, and available in the <tt>fda</tt> package in <tt>R</tt>) consists of measurements obtained across <span class="math inline">\(N = 35\)</span> Canadian cities: in particular, we focus on the daily average temperatures for each of these cities, averaged from 1960-1994 (hence, for every city we have <span class="math inline">\(n = 365\)</span> temperature measurements). We denote the day of the measurement as <span class="math inline">\(t_{ij} \in \{1,2,\ldots,365\}\)</span>, and the daily average temperature (in Celsius) as <span class="math inline">\(y_{ij}\)</span>, where the subscript <span class="math inline">\(i \in \{1,2,\ldots,35\}\)</span> indicates the city to which the measurement corresponds, and the subscript <span class="math inline">\(j \in \{1,2,\ldots,365\}\)</span> indicates the day to which the measurement corresponds. Therefore, we denote the full data set as <span class="math inline">\(\{t_{ij},y_{ij}\}^{N,n}_{i = 1,j = 1}\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Similarly to the Motorcycle data set context, we denote <span class="math inline">\(Y_{ij}\)</span> as the random variable corresponding to the average temperature of the <span class="math inline">\(j\)</span>-th day on the <span class="math inline">\(i\)</span>-th city, and assume that</p>
<p><span class="math display">\[
  \mathbb{E}[Y_{ij}] = g_i(t_{ij}) \quad i \in \{1,\ldots,N\}, j \in \{1,\ldots,n\}.
\]</span> A key difference between this formulation and that which is seen in <a href="#eq-expectation" class="quarto-xref">Equation&nbsp;1</a> is that the mean function is allowed to vary dependent on the city, that is, we assume that the mean daily temperature profile is different in each city<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Again, we’ll assume that <span class="math inline">\(Y_{ij} \sim \text{Normal}(g(t_{ij}), 1/\tau_i), \tau_i &gt; 0\)</span>, or equivalently</p>
<p><span class="math display">\[
  y_{ij} = g_i(t_{ij}) + \tau^{-1/2}_i \varepsilon_{ij} \quad i \in \{1,\ldots,N\}, j \in \{1,\ldots,n\},
\]</span> where <span class="math inline">\(\varepsilon_{ij} \sim \text{Normal}(0,1), i \in \{1,\ldots,N\}, j \in \{1,\ldots,n\}\)</span>. Again we seek to determine estimators <span class="math inline">\(\hat{g}_i(\cdot)\)</span> for the mean temperature functions, and likewise we assume that the mean temperature functions may be decomposed as linear combinations of a set of basis functions <span class="math inline">\(\{\phi_k(\cdot)\}_{k = 1}^K\)</span> of the form <span class="math display">\[
  g_i(t) = \sum^K_{k = 1}\beta_{ik} \phi_k(t),
\]</span> for some <span class="math inline">\(\boldsymbol{\beta}_i \in \mathbb{R}^K\)</span>. Unlike the Motorcycle data set application, we consider a different set of basis functions: as we know that the observed functions represent weather observations, we find it ideal that the basis functions accommodate periodic trends that may appear. One ideal family of basis functions in such case is the family of Fourier basis functions (in particular, we adopt <span class="math inline">\(K = 51\)</span> Fourier basis functions - also including an intercept term - with a periodicity of <span class="math inline">\(365\)</span>, starting at <span class="math inline">\(t = 1/2\)</span> and ending at <span class="math inline">\(t = 365 + 1/2\)</span>, where the additional <span class="math inline">\(1/2\)</span> serves to accommodate the transition between the last day of one year and the first day of the next). Disadvantageous to the Fourier approximation, however, is that the Fourier design matrix is not sparse, as the B-spline design matrix may be, and consequently the usage of Fourier basis is more computationally costly. Let <span class="math inline">\(\boldsymbol{\Phi}_i \in \mathbb{R}^{K \times K}\)</span> and <span class="math inline">\(\boldsymbol{\phi}_i(t) \in \mathbb{R}^K\)</span> be defined as <span class="math display">\[
  \boldsymbol{\Phi}_i = \begin{pmatrix}
    \phi_{1}(t_{i1}) &amp; \phi_{2}(t_{i1}) &amp; \dots &amp; \phi_{K}(t_{i1}) \\
    \phi_{1}(t_{i2}) &amp; \phi_{2}(t_{i2}) &amp; \dots &amp; \phi_{K}(t_{i2}) \\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    \phi_{1}(t_{in}) &amp; \phi_{2}(t_{in}) &amp; \dots &amp; \phi_{K}(t_{in})
  \end{pmatrix} \quad \text{and} \quad \boldsymbol{\phi}_i(t) = \begin{pmatrix}
    \phi_1(t) \\
    \phi_2(t) \\
    \vdots \\
    \phi_K(t)
  \end{pmatrix}.
\]</span> Analogously to previous results, we find that the maximum likelihood estimators of the coefficients <span class="math inline">\(\boldsymbol{\beta}_i\)</span> are <span class="math display">\[
  \{\hat{\boldsymbol{\beta}}_\text{ML}\}_i = (\boldsymbol{\Phi}_i^\text{T}\boldsymbol{\Phi}_i)^{-1}\boldsymbol{\Phi}^\text{T}_i\mathrm{y}_i \quad i \in \{1,\ldots,N\},
\]</span> assuming <span class="math inline">\(\boldsymbol{\Phi}_i^\text{T} \boldsymbol{\Phi}_i\)</span> is positive-definite for <span class="math inline">\(i \in \{1,\ldots,N\}\)</span>. The estimated mean functions, as well as the original observed data, are plotted in <a href="#fig-canadian-weather" class="quarto-xref">Figure&nbsp;3</a>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb4" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>K_canadian <span class="ot">=</span> <span class="dv">51</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>eval_x_canadian <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fl">365.5</span>, <span class="at">length.out =</span> <span class="fl">1e3</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>canadianWeather_fda <span class="ot">=</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>           design_basis <span class="ot">=</span> <span class="fu">create.fourier.basis</span>(<span class="at">rangeval =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">365.5</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">nbasis =</span> K_canadian,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">period =</span> <span class="dv">365</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           design_matrix <span class="ot">=</span> design_basis <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basisobj =</span> .,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>           design_matrixf <span class="ot">=</span> design_basis <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> eval_x_canadian,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">basisobj =</span> .,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>           coefficients <span class="ot">=</span> design_matrix <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>             {<span class="fu">solve</span>(<span class="at">a =</span> <span class="fu">t</span>(.) <span class="sc">%*%</span> .,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">b =</span> <span class="fu">t</span>(.) <span class="sc">%*%</span> CanadianWeather<span class="sc">$</span>dailyAv[ , x , <span class="dv">1</span>])}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">K =</span> K_canadian,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">design_matrix =</span> design_matrix,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">design_matrixf =</span> design_matrixf,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coefficients =</span> coefficients,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fitted_values =</span> design_matrix <span class="sc">%*%</span> coefficients,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">eval_values =</span> design_matrixf <span class="sc">%*%</span> coefficients,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">place =</span> CanadianWeather<span class="sc">$</span>place[x],</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">day =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>           })</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>(<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">values =</span> canadianWeather_fda[[x]]<span class="sc">$</span>eval_values,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eval_x =</span> eval_x_canadian,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>place[x],</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>place)),</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)),</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> {<span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .)} <span class="sc">%&gt;%</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> .,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> values,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> x,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> region)) <span class="sc">+</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Day of the year"</span>,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Temperature (in "</span>, <span class="fu">italic</span>(<span class="st">"°C"</span>), <span class="st">")"</span>)),</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">values =</span> CanadianWeather<span class="sc">$</span>dailyAv[ , x , <span class="dv">1</span>],</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eval_x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>place[x],</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>place)),</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)))</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> {<span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .)} <span class="sc">%&gt;%</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> .,</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> values,</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> x,</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col =</span> region)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-canadian-weather" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-canadian-weather-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-canadian-weather-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-canadian-weather-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Estimated mean functions for each city in the Canadian weather data set, with <span class="math inline">\(K = 51\)</span>. The original observed data are likewise plotted.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As we deal with a larger number of functions to estimate in this application, we opt to attribute to all expansions the same number of basis functions (<span class="math inline">\(K = 51\)</span>). As may be seen in <a href="#fig-canadian-weather" class="quarto-xref">Figure&nbsp;3</a>, the original data set presents a variable <tt>region</tt> which divides the cities with respect to their corresponding climate zones, although this characteristic is not further explored in this vignette.</p>
</section>
<section id="simulated-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="simulated-data">Simulated data</h3>
<p>In addition to the two data sets presented above, we also consider two distinct scenarios of simulated data. Firstly, we consider a data set comprised of <span class="math inline">\(N\)</span> functions sampled <span class="math inline">\(n\)</span> times each, generated from a cubic B-spline basis set of functions, with equidistant knots starting at <span class="math inline">\(0\)</span> and ending at <span class="math inline">\(1\)</span>, such that we have 10 basis functions, however only 6 have non-zero true coefficients. The sampling design is regular (see the footnotes) in the interval <span class="math inline">\([0,1]\)</span>. Our goal with this simulation is to determine the accuracy of the estimated coefficients for the ARD procedure. The data is generated as follows</p>
<p><span id="eq-simulation-i"><span class="math display">\[
  y_{ij} = \boldsymbol{\phi}^\text{T}(t_{ij})\begin{pmatrix}
    -2 \\
    0 \\
    3/2 \\
    3/2 \\
    0 \\
    -1 \\
    -1/2 \\
    -1 \\
    0 \\
    0
  \end{pmatrix} + \tau^{-1/2}\varepsilon_{ij},
\tag{5}\]</span></span> where <span class="math inline">\(\boldsymbol{\phi}(t)\)</span> is as in <a href="#eq-matrix" class="quarto-xref">Equation&nbsp;4</a> and <span class="math inline">\(\tau = 25\)</span>. <a href="#fig-simulation-i-data" class="quarto-xref">Figure&nbsp;4</a> illustrates one generated replication of this data set.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb5" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23121998</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>replication_1 <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>N_1 <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>n_1 <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>t_1 <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n_1)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>tau_1 <span class="ot">=</span> .<span class="dv">2</span> <span class="sc">**</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>K_1 <span class="ot">=</span> <span class="fu">length</span>(beta_1)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>beta_in_1 <span class="ot">=</span> <span class="fu">which</span>(beta_1 <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>beta_out_1 <span class="ot">=</span> <span class="fu">which</span>(beta_1 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>Phi_1 <span class="ot">=</span> <span class="fu">create.bspline.basis</span>(<span class="at">rangeval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">norder =</span> <span class="dv">4</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nbasis =</span> K_1) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> t_1,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">basisobj =</span> .,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>mean_1 <span class="ot">=</span> Phi_1 <span class="sc">%*%</span> beta_1</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>sim_data_1 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_1,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                      y <span class="ot">=</span> mean_1 <span class="sc">+</span> (tau_1 <span class="sc">**</span> (<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_1)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">return</span>(y)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>(<span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_1,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(<span class="at">x =</span> t_1,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> sim_data_1[[x]],</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ind =</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span>N_1))</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">args =</span> .) <span class="sc">|&gt;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> y,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> ind,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> ind)) <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(t)[ij])),</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(y)[ij]))) <span class="sc">+</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> N_1)) <span class="sc">+</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1/2"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-simulation-i-data" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-simulation-i-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-simulation-i-data-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-simulation-i-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: <span class="math inline">\(N = 10\)</span> functions sampled at <span class="math inline">\(n = 10\)</span> instants according to <a href="#eq-simulation-i" class="quarto-xref">Equation&nbsp;5</a>
</figcaption>
</figure>
</div>
</div>
</div>
<p>For the second simulation, we generated a data set composed of <span class="math inline">\(N\)</span> functions sampled <span class="math inline">\(n\)</span> times each (again, the sampling design is regular in the interval <span class="math inline">\([0,2\pi]\)</span>), where the mean curve is the sum of two trigonometric functions, as in</p>
<p><span id="eq-simulation-ii"><span class="math display">\[
  y_{ij} = \cos(t_{ij}) + \sin(2 t_{ij}) + \tau^{-1/2}\varepsilon_{ij},
\tag{6}\]</span></span></p>
<p>with <span class="math inline">\(\tau = 25\)</span>. Unlike the previous simulation, we consider the mean function expansions <span class="math inline">\(\hat{g}_i(\cdot)\)</span> as resulting from a linear combination of <span class="math inline">\(K = 10\)</span> Fourier basis functions, with periodicity equal to <span class="math inline">\(2\pi\)</span>, starting at <span class="math inline">\(0\)</span>. Similarly to the previous simulation, this implies that the coefficients in the resulting expansion must be non-zero for only two of the basis functions. <a href="#fig-simulation-ii-data" class="quarto-xref">Figure&nbsp;5</a> illustrates one generated replication of this data set.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb6" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12231998</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>replication_2 <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>N_2 <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>n_2 <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>t_2 <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">length.out =</span> n_2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>tau_2 <span class="ot">=</span> .<span class="dv">2</span> <span class="sc">**</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>beta_2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>K_2 <span class="ot">=</span> <span class="fu">length</span>(beta_2)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>beta_in_2 <span class="ot">=</span> <span class="fu">which</span>(beta_2 <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>beta_out_2 <span class="ot">=</span> <span class="fu">which</span>(beta_2 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>mean_2 <span class="ot">=</span> <span class="fu">cos</span>(t_2) <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> t_2)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>sim_data_2 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_2,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                      y <span class="ot">=</span> mean_2 <span class="sc">+</span> (tau_2 <span class="sc">**</span> (<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">return</span>(y)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>(<span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_2,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(<span class="at">x =</span> t_2,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> sim_data_2[[x]],</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ind =</span> <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span>N_2))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">args =</span> .) <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> y,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> ind,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> ind)) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(t)[ij])),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(y)[ij]))) <span class="sc">+</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> N_1)) <span class="sc">+</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, pi, <span class="dv">2</span> <span class="sc">*</span> pi),</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">expression</span>(<span class="st">"0"</span>, pi, <span class="fu">paste</span>(<span class="st">"2"</span>, pi))) <span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-simulation-ii-data" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-simulation-ii-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-simulation-ii-data-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-simulation-ii-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: <span class="math inline">\(N = 10\)</span> functions sampled at <span class="math inline">\(n = 10\)</span> instants according to <a href="#eq-simulation-ii" class="quarto-xref">Equation&nbsp;6</a>
</figcaption>
</figure>
</div>
</div>
</div>
<p>For both simulations we’ll consider 9 possible scenarios, with varying values for <span class="math inline">\(N\)</span> and <span class="math inline">\(n\)</span>, whice are presented in <a href="#tbl-simulation-scenarios" class="quarto-xref">Table&nbsp;1</a>.</p>
<div class="cell page-columns page-full" data-tbl-cap-location="margin">
<div id="tbl-simulation-scenarios" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-tbl-cap-location="margin">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-simulation-scenarios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">N</th>
<th style="text-align: left;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">1000</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">1000</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">1000</td>
<td style="text-align: left;">1000</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-simulation-scenarios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Scenarios for the simulation studies.
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>This vignette is primarily concerned with presenting an approach to sparse representation of Functional Data utilizing the Automatic Relevance Determination (ARD) framework, itself only a topic in the wider Sparse Bayesian Learning (SBL) context. More precisely, our aim herein is to replicate some of the studies in <span class="citation" data-cites="sousa:2024">Sousa, Souza, and Dias (<a href="#ref-sousa:2024" role="doc-biblioref">2024</a>)</span> and <span class="citation" data-cites="daCruz:2024">Cruz, Souza, and Sousa (<a href="#ref-daCruz:2024" role="doc-biblioref">2024</a>)</span> (the former moreso than the latter, as we do not account for any correlation structure in the functions). The goal of these previous studies was to provide an adaptive Bayesian procedure to select the bases for functional data representation, the latter also extending the results of the former by including a correlation structure for the functional data, and delineating an estimation procedure utilizing the Variational Bayes (VB) approach. It did so by including a collection of Bernoulli random variables (denoted <span class="math inline">\(Z_{k}\)</span>), each associated with one particular term in the basis expansion in <a href="#eq-expansion" class="quarto-xref">Equation&nbsp;3</a>, resulting in the form <span class="math inline">\(\tilde{\beta}_{k} = Z_{k} \beta_{k}\)</span>, such that <span class="math inline">\(\mathbb{P}(\tilde{\beta}_{k} = 0) &gt; 0\)</span>. The ARD approach, which is presented subsequently, similarly works as Bayesian model.</p>
<section id="automatic-relevance-determination" class="level3">
<h3 class="anchored" data-anchor-id="automatic-relevance-determination">Automatic Relevance Determination</h3>
<p>The ARD approach attributes the following hierarchical Bayesian model:</p>
<p><span class="math display">\[
  \begin{aligned}
    y(t_{j}) \vert \{\beta_{k}\}, \tau &amp; \sim \text{Normal}\Bigg(\sum^K_{k = 1}\beta_{k}\phi_k(t_{j}), \tau^{-1}\Bigg) &amp; j \in \{1,\ldots,n\} \\
    {\beta}_{k} \vert  \alpha_{k} &amp; \sim \text{Normal}(0,\alpha_{k}^{-1}) &amp; k \in \{1,\ldots,K\}.
  \end{aligned}
\]</span> Where <span class="math inline">\(\{\alpha_{k}\}\)</span> (greater than zero) are hyperparameters which dictate the concentration of the coefficients around zero, whilst <span class="math inline">\(\tau\)</span> (also greater than zero) is a hyperparameter which dictates the precision of the sampled observations. In adopting the empirical Bayes approach to estimate the model, we aim to determine the hyperparameter values which maximize the distribution of the observations points marginalized over the coefficients <span class="math inline">\(\{\beta_{k}\}\)</span>. <span class="citation" data-cites="tipping:2001">Tipping (<a href="#ref-tipping:2001" role="doc-biblioref">2001</a>)</span> proposes a straightforward set of update equations for the hyperparameters (as well as for the coefficients, which are estimated via their maximum a posteriori value). These are as follows:</p>
<p><span id="eq-beta"><span class="math display">\[
  \hat{\boldsymbol{\beta}} = \hat{\tau} \boldsymbol{\Sigma}\Phi^\text{T}\mathrm{y}
\tag{7}\]</span></span></p>
<p><span id="eq-alpha"><span class="math display">\[
  \hat{\alpha}_k = \frac{\gamma_k}{\hat{\beta}_k^2}
\tag{8}\]</span></span></p>
<p><span id="eq-tau"><span class="math display">\[
  \frac{1}{\hat{\tau}} = \frac{\lvert\lvert \textbf{y} - \Phi \hat{\boldsymbol{\beta}}\rvert\rvert^2}{n - \sum^K_{k = 1}\gamma_{k}} \quad k \in \{1,\ldots,K\}
\tag{9}\]</span></span></p>
<p>where</p>
<p><span id="eq-sigma"><span class="math display">\[
  \boldsymbol{\Sigma} = (\text{diag}(\hat{\alpha}) + \hat{\tau} \boldsymbol{\Phi}^\text{T}\boldsymbol{\Phi})^{-1}
\tag{10}\]</span></span></p>
<p><span id="eq-gamma"><span class="math display">\[
  \gamma_{k} = 1 - \hat{\alpha}_{k}\Sigma_{kk} \quad k \in \{1,\ldots,K\}.
\tag{11}\]</span></span></p>
<p><span class="citation" data-cites="tipping:2001">Tipping (<a href="#ref-tipping:2001" role="doc-biblioref">2001</a>)</span> likewise demonstrates that, under certain circumstances, <span class="math inline">\(\hat{\alpha}_k \approx \infty\)</span>, under which condition the prior distribution of <span class="math inline">\(\beta_k \vert \alpha_k\)</span> is approximately degenerate at 0 (as is the consequent posterior). We provide an algorithm for the estimation of an ARD model, given the above updating equations:</p>
<div class="algo-class">
<p><span class="smallcaps">Initialization</span>. Enter a valid response vector <span class="math inline">\(\mathrm{y}\)</span> and a valid predictor matrix <span class="math inline">\(\boldsymbol{\Phi}\)</span>. Set a cutoff value <span class="math inline">\(M &gt; 0\)</span> such that, if <span class="math inline">\(\hat{\alpha}_k &gt; M\)</span>, <span class="math inline">\(\hat{\beta}_k = 0\)</span>. Set initial values for the estimators <span class="math inline">\(\hat{\tau} = \tau_0\)</span> and <span class="math inline">\(\hat{\alpha} = \alpha_0\)</span>. Thereafter, perform the following steps in sequence.</p>
<ol type="1">
<li>Compute the quantities in <a href="#eq-sigma" class="quarto-xref">Equation&nbsp;10</a> and <a href="#eq-gamma" class="quarto-xref">Equation&nbsp;11</a>.</li>
<li>Update <span class="math inline">\(\hat{\beta}_k\)</span> (for variables still in the model) according to <a href="#eq-beta" class="quarto-xref">Equation&nbsp;7</a>.</li>
<li>Update <span class="math inline">\(\hat{\alpha}_k\)</span> (for variables still in the model) and <span class="math inline">\(\hat{\tau}\)</span> according to <a href="#eq-alpha" class="quarto-xref">Equation&nbsp;8</a> and <a href="#eq-tau" class="quarto-xref">Equation&nbsp;9</a>.</li>
<li>For every <span class="math inline">\(k \in \{1,\ldots,K\}\)</span> if <span class="math inline">\(\hat{\alpha}_{k} &gt; M\)</span>, remove the <span class="math inline">\(k\)</span>-th variable from the model.</li>
<li>Check the convergence of the estimates. If convergence has occurred, stop. Else, return to step (1).</li>
</ol>
</div>
<p>The function <tt>ard_model()</tt> in the chunk below performs the estimating procedure.</p>
<div class="cell">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ard_model <span class="ot">=</span> <span class="cf">function</span>(y,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                     Phi,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tau_ini =</span> <span class="dv">1</span>,                             </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha_ini =</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">times =</span> <span class="fu">ncol</span>(Phi)),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_iter =</span> <span class="fl">1e3</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">tol =</span> <span class="fl">1e-8</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cutoff =</span> <span class="fl">1e4</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">length</span>(y)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">=</span> <span class="fu">ncol</span>(Phi)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  tau <span class="ot">=</span> tau_ini</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">=</span> alpha_ini</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  keep <span class="ot">=</span> <span class="sc">!</span><span class="fu">logical</span>(K)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  beta_est <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> K)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  gamma_est <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> K)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  cond <span class="ot">=</span> <span class="cn">Inf</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  beta_est0 <span class="ot">=</span> beta_est <span class="sc">+</span> <span class="cn">Inf</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>((iter <span class="sc">&lt;</span> max_iter) <span class="sc">&amp;</span> (<span class="fu">abs</span>(cond) <span class="sc">&gt;</span> tol))</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    Phi_keep <span class="ot">=</span> Phi[,keep]</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    A <span class="ot">=</span> <span class="fu">diag</span>(alpha[keep])</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> <span class="fu">solve</span>(A <span class="sc">+</span> tau <span class="sc">*</span> <span class="fu">t</span>(Phi_keep) <span class="sc">%*%</span> Phi_keep)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    beta_est[keep] <span class="ot">=</span> tau <span class="sc">*</span> Sigma <span class="sc">%*%</span> <span class="fu">t</span>(Phi_keep) <span class="sc">%*%</span> y</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    gamma_est[keep] <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> alpha[keep] <span class="sc">*</span> <span class="fu">diag</span>(Sigma)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    alpha[keep] <span class="ot">=</span> gamma_est[keep] <span class="sc">/</span> (beta_est[keep] <span class="sc">**</span> <span class="dv">2</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    tau <span class="ot">=</span> (n <span class="sc">-</span> <span class="fu">sum</span>(gamma_est[keep])) <span class="sc">/</span> <span class="fu">sum</span>((y <span class="sc">-</span> Phi_keep <span class="sc">%*%</span> beta_est[keep]) <span class="sc">**</span> <span class="dv">2</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    keep <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="at">test =</span> alpha <span class="sc">&lt;</span> cutoff, <span class="at">yes =</span> T, <span class="at">no =</span> F)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    beta_est[<span class="sc">!</span>keep] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    alpha[<span class="sc">!</span>keep] <span class="ot">=</span> <span class="cn">Inf</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    iter <span class="sc">%&lt;&gt;%</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    cond <span class="ot">=</span> <span class="fu">sum</span>((beta_est <span class="sc">-</span> beta_est0) <span class="sc">**</span> <span class="dv">2</span>) </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    beta_est0 <span class="ot">=</span> beta_est</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  fitted_values <span class="ot">=</span> Phi[,keep] <span class="sc">%*%</span> beta_est[keep]</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  R2_adj0 <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> ((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="fu">length</span>(gamma_est[keep]))) <span class="sc">*</span> (<span class="fu">sum</span>((y <span class="sc">-</span> fitted_values) <span class="sc">**</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>((y <span class="sc">-</span> <span class="fu">mean</span>(y)) <span class="sc">**</span> <span class="dv">2</span>))</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  R2_adj <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> ((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="fu">sum</span>(gamma_est[keep]))) <span class="sc">*</span> (<span class="fu">sum</span>((y <span class="sc">-</span> fitted_values) <span class="sc">**</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>((y <span class="sc">-</span> <span class="fu">mean</span>(y)) <span class="sc">**</span> <span class="dv">2</span>))</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  time <span class="sc">%&lt;&gt;%</span> {<span class="fu">Sys.time</span>() <span class="sc">-</span> .}</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">iter =</span> iter,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>              <span class="at">tau =</span> tau,</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> alpha[keep],</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>              <span class="at">beta =</span> beta_est[keep],</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">gamma =</span> gamma_est[keep],</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">keep =</span> <span class="fu">which</span>(keep),</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>              <span class="at">time =</span> time,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">fitted_values =</span> fitted_values,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>              <span class="at">R2_adj =</span> R2_adj,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>              <span class="at">R2_adj0 =</span> R2_adj0))</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="citation" data-cites="bishop:2006">Bishop (<a href="#ref-bishop:2006" role="doc-biblioref">2006</a>)</span> suggests utilizing <span class="math inline">\(\{\gamma_k\}\)</span>, defined in <a href="#eq-gamma" class="quarto-xref">Equation&nbsp;11</a>, as a measure of the model complexity, defining the effective degrees of freedom of the model as <span class="math display">\[
  \text{df}_\text{eff} = \sum^K_{k = 1}\gamma_k.
\]</span> Note that, if the <span class="math inline">\(k\)</span>-th coefficient is included in the model, <span class="math inline">\(\gamma_k \in [0,1]\)</span>, whereas if its not included, <span class="math inline">\(\gamma_k = 0\)</span>. In the following section we’ll utilize two distinct measures of quality of fit for our models. First, we define the usual adjusted <span class="math inline">\(R\)</span> squared as <span class="math display">\[
  R^2_\text{adj} = 1 - \frac{n - 1}{n - \hat{K}_0} \frac{\sum^n_{i = 1}(y_i - \hat{g}(t_i))^2}{\sum^n_{i = 1}(y_i - \bar{y}^2)},
\]</span> where <span class="math display">\[
  \hat{K}_0 = K - \sum^K_{k = 1} \textbf{1}_{\{0\}}(\hat{\beta}_k),
\]</span> that is, <span class="math inline">\(\hat{K}_0 \in [0,K]\)</span> is the number of non-zero coefficients in the estimated model. We additionally define <span class="math display">\[
  \widetilde{R}^2_\text{adj} = 1 - \frac{n - 1}{n - \text{df}_\text{eff}} \frac{\sum^n_{i = 1}(y_i - \hat{g}(t_i))^2}{\sum^n_{i = 1}(y_i - \bar{y}^2)}.
\]</span> Note that <span class="math inline">\(\text{df}_\text{eff} \in [0,K_0]\)</span>, hence <span class="math inline">\(\widetilde{R}^2_\text{adj} \geq R^2_\text{adj}\)</span>.</p>
</section>
</section>
</section>
<section id="applications-and-simulations" class="level1 page-columns page-full">
<h1>Applications and Simulations</h1>
<section id="sec-app-mcycle" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-app-mcycle">Application I</h2>
<p>For the Motorcycle data set application, we utilize the cubic B-spline expansion composed of <span class="math inline">\(K = 20\)</span> basis functions. We first set the cutoff <span class="math inline">\(M\)</span> in the ARD algorithm to an arbitrarily large value (<span class="math inline">\(\log_{10}M = 4\)</span>), in which case the the estimated model had <span class="math inline">\(\hat{K}_0 = 7\)</span> non-zero coefficients. However, by setting the cutoff to a lower value (<span class="math inline">\(\log_{10} M = -2\)</span>) we found the model’s adjusted <span class="math inline">\(R\)</span> squared had improved, with the model having only <span class="math inline">\(\hat{K}_0 = 5\)</span> non-zero coefficients. It may therefore be of interest to view the cutoff value <span class="math inline">\(M\)</span> as a tuning parameter. <a href="#fig-mcycle-ard" class="quarto-xref">Figure&nbsp;6</a> illustrates the estimated model.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb8" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mcycle_ard <span class="ot">=</span> <span class="fu">ard_model</span>(<span class="at">y =</span> mcycle<span class="sc">$</span>accel,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Phi =</span> mcycle_fda[[ind]]<span class="sc">$</span>design_matrix,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cutoff =</span> <span class="fl">1e-2</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>(mcycle_ard <span class="sc">%&gt;%</span> {<span class="fu">data.frame</span>(<span class="at">eval_x =</span> eval_x,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eval_values =</span> mcycle_fda[[ind]]<span class="sc">$</span>design_matrixf[,.<span class="sc">$</span>keep] <span class="sc">%*%</span> .<span class="sc">$</span>beta)} <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> eval_values,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="st">"ARD estimate"</span>)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  (mcycle <span class="sc">|&gt;</span> <span class="fu">geom_point</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> times,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> accel))) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  (mcycle_fda[[ind]] <span class="sc">%&gt;%</span> {<span class="fu">data.frame</span>(<span class="at">eval_x =</span> eval_x,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">eval_values =</span> .<span class="sc">$</span>design_matrixf <span class="sc">%*%</span> .<span class="sc">$</span>coefficients)} <span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> eval_values,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">col =</span> <span class="st">"ML estimate"</span>))) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Time after impact (in "</span>, <span class="fu">italic</span>(<span class="st">"ms"</span>), <span class="st">")"</span>)),</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Acceleration (in "</span>, <span class="fu">italic</span>(<span class="st">"g"</span>), <span class="st">")"</span>)),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">2</span>))) <span class="sc">/</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">guide_area</span>()) <span class="sc">/</span> </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>(coef_plots[[ind]]<span class="sc">$</span>g <span class="sc">+</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>)) <span class="sc">+</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  (mcycle_ard <span class="sc">%&gt;%</span> {<span class="fu">data.frame</span>(<span class="at">x =</span> .<span class="sc">$</span>keep,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> .<span class="sc">$</span>beta) <span class="sc">|&gt;</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> y),</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col =</span> <span class="st">"red"</span>)})) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">4</span>, .<span class="dv">5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'I'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-mcycle-ard" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mcycle-ard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-mcycle-ard-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mcycle-ard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Panel I: Estimated mean functions for the Motorcycle data set, with <span class="math inline">\(K = 20\)</span>, obtained via the ARD procedure and Maximum Likelihood (ML). Panel II: Estimated coefficients for basis expansions of the Motorcycle data set, with <span class="math inline">\(K = 20\)</span>. The black points are those obtained via ML, whilst the red points are those obtained via ARD. Estimates equal to zero are ommited.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The observed adjusted <span class="math inline">\(R\)</span> squared values were <span class="math inline">\(R^2_\text{adj} \approx 0.7858\)</span> and <span class="math inline">\(\widetilde{R}^2_\text{adj} \approx 0.7864\)</span>. Note that the ARD procedure selects basis functions which model the interval where the acceleration showcases a valley followed by a peak, effectively capturing the most apparent trends in the data whilst utilizing only 25% of the originally proposed basis functions. The basis functions which correspond to the beginning of the mean function (around 15<span class="math inline">\(ms\)</span> after impact), where the data is approximately inert, are removed, as are those which model the tail end of the mean function (around 40<span class="math inline">\(ms\)</span> after impact), as was expected. These results follow closely those obtained in <span class="citation" data-cites="daCruz:2024">Cruz, Souza, and Sousa (<a href="#ref-daCruz:2024" role="doc-biblioref">2024</a>)</span>.</p>
</section>
<section id="application-ii" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="application-ii">Application II</h2>
<p>For the Canadian weather application, as previously stated, we utilized <span class="math inline">\(K = 51\)</span> Fourier basis functions, starting at <span class="math inline">\(1/2\)</span> and ending at <span class="math inline">\(365 + 1/2\)</span>, with periodicity of <span class="math inline">\(365\)</span>. We adopted as the cutoff parameter the value of <span class="math inline">\(\log_{10} M = 4\)</span>, though we also found that lower values (e.g.&nbsp;<span class="math inline">\(\log_{10} M = 2\)</span>) exhibit similar overall performance. <a href="#fig-canadian-ard" class="quarto-xref">Figure&nbsp;7</a> illustrates the estimated mean functions.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb9" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>canadianWeather_ard <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ard_model</span>(<span class="at">y =</span> CanadianWeather<span class="sc">$</span>dailyAv[ , x, <span class="dv">1</span>],</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">Phi =</span> canadianWeather_fda[[x]]<span class="sc">$</span>design_matrix,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">cutoff =</span> <span class="fl">1e4</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                             })</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>(canadianWeather_ard <span class="sc">%&gt;%</span> {<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(<span class="at">eval_x =</span> eval_x_canadian,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> canadianWeather_fda[[x]]<span class="sc">$</span>design_matrixf[,.[[x]]<span class="sc">$</span>keep] <span class="sc">%*%</span> .[[x]]<span class="sc">$</span>beta,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>place[x],</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>place)),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        })} <span class="sc">%&gt;%</span> {<span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .)} <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> .,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> values,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> x,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> region)) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Day of the year"</span>,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Temperature (in "</span>, <span class="fu">italic</span>(<span class="st">"°C"</span>), <span class="st">")"</span>)),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.frame</span>(<span class="at">values =</span> CanadianWeather<span class="sc">$</span>dailyAv[ , x , <span class="dv">1</span>],</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eval_x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>,</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>place[x],</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>place)),</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)),</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> {<span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .)} <span class="sc">%&gt;%</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">inherit.aes =</span> F,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> .,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eval_x,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> values,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> x,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col =</span> region)))</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>time_canadian_ARD <span class="ot">=</span> canadianWeather_ard <span class="sc">%&gt;%</span> {<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place), <span class="at">FUN =</span> <span class="cf">function</span>(x){.[[x]]<span class="sc">$</span>time})} <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>p_basis_canadian_ARD <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> (canadianWeather_ard <span class="sc">%&gt;%</span> {<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place), <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">length</span>(.[[x]]<span class="sc">$</span>keep)})} <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">mean</span>()) <span class="sc">/</span> K_canadian</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>R2_adj_basis_canadian_ARD <span class="ot">=</span> canadianWeather_ard <span class="sc">%&gt;%</span> {<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place), <span class="at">FUN =</span> <span class="cf">function</span>(x){.[[x]]<span class="sc">$</span>R2_adj})} <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>R2_adj0_basis_canadian_ARD <span class="ot">=</span> canadianWeather_ard <span class="sc">%&gt;%</span> {<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place), <span class="at">FUN =</span> <span class="cf">function</span>(x){.[[x]]<span class="sc">$</span>R2_adj0})} <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-canadian-ard" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-canadian-ard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-canadian-ard-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-canadian-ard-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Estimated mean functions for each city in the Canadian weather data set, with <span class="math inline">\(K = 51\)</span>, obtained via the ARD procedure. The original observed data are likewise plotted.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We note that the ARD estimation procedure for all functions took approximately 4.8932 seconds to finish, and kept on average approximately <span class="math inline">\(74.8459\%\)</span> of the original basis functions per estimated mean function, resulting in an average adjusted <span class="math inline">\(R\)</span> squared of <span class="math inline">\(R^2_\text{adj} \approx 0.9968\)</span> and <span class="math inline">\(\widetilde{R}^2_\text{adj} \approx 0.9969\)</span>. <a href="#fig-canadian-ard-coef" class="quarto-xref">Figure&nbsp;8</a> exhibits the coefficients corresponding to the estimated mean functions.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb10" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p_canadian_1 <span class="ot">=</span> (<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>         canadianWeather_ard[[x]] <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         {<span class="fu">data.frame</span>(<span class="at">kept =</span> .<span class="sc">$</span>keep,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">beta =</span> .<span class="sc">$</span>beta,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">row.names =</span> <span class="cn">NULL</span>)}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">args =</span> .) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> kept,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> beta,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> region)) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Basis index ("</span>, <span class="fu">italic</span>(k), <span class="st">")"</span>)),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Estimated coefficient ("</span>, <span class="fu">hat</span>(beta)[<span class="fu">italic</span>(ik)], <span class="st">")"</span>)),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">yintercept =</span> <span class="dv">0</span>))</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>p_canadian_2 <span class="ot">=</span> (<span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(CanadianWeather<span class="sc">$</span>place),</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>         canadianWeather_ard[[x]] <span class="sc">%&gt;%</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>         {<span class="fu">data.frame</span>(<span class="at">kept =</span> .<span class="sc">$</span>keep,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">region =</span> <span class="fu">factor</span>(CanadianWeather<span class="sc">$</span>region[x],</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">levels =</span> <span class="fu">unique</span>(CanadianWeather<span class="sc">$</span>region)),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                    <span class="at">beta =</span> .<span class="sc">$</span>beta,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                    <span class="at">row.names =</span> <span class="cn">NULL</span>)}</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>                      <span class="at">args =</span> .) <span class="sc">|&gt;</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">subset</span>(kept <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> kept,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> beta,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> region)) <span class="sc">+</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Basis index ("</span>, <span class="fu">italic</span>(k), <span class="st">")"</span>)),</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Estimated coefficient ("</span>, <span class="fu">hat</span>(beta)[<span class="fu">italic</span>(ik)], <span class="st">")"</span>)),</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">51</span>)) <span class="sc">+</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">yintercept =</span> <span class="dv">0</span>))</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>p_canadian_1 <span class="sc">+</span> <span class="fu">inset_element</span>(p_canadian_2, .<span class="dv">132</span>, .<span class="dv">05</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'I'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-canadian-ard-coef" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-canadian-ard-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-canadian-ard-coef-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-canadian-ard-coef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Panel I: Estimated coefficients for basis expansions of the Canadian weather data set, with <span class="math inline">\(K = 51\)</span>, obtained via the ARD procedure. Panel II: Inset zoom-in of the former Panel for basis indexes between 6 and 51.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As is expected when utilizing a Fourier basis expansion, the coefficients associated with basis’ with higher frequencies are smaller in absolute value, some close to zero. Nevertheless, we found that these basis’ are only removed from the model when the cutoff is lower than <span class="math inline">\(\log_{10} M = 0\)</span>. Moreover, the model obtained with <span class="math inline">\(\log_{10} M = 0\)</span> has worsened average adjusted <span class="math inline">\(R\)</span> squared. Consequently, we opted to stick with the cutoff of <span class="math inline">\(\log_{10} M = 4\)</span>. <a href="#tbl-canadian" class="quarto-xref">Table&nbsp;2</a> presents some diagnostic values obtained from the model (<span class="math inline">\(R^2_\text{adj}\)</span> is denoted as <strong>R2 I</strong> and <span class="math inline">\(\widetilde{R}^2_\text{adj}\)</span> is denoted as <strong>R2 II</strong>), discriminated by city. Once more, the results followed closely those obtained in <span class="citation" data-cites="daCruz:2024">Cruz, Souza, and Sousa (<a href="#ref-daCruz:2024" role="doc-biblioref">2024</a>)</span>.</p>
<div class="cell page-columns page-full" data-tbl-cap-location="margin">
<div id="tbl-canadian" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-tbl-cap-location="margin">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-canadian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b10ae2c8ea280e4bd667" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b10ae2c8ea280e4bd667">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35"],["St. Johns","Halifax","Sydney","Yarmouth","Charlottvl","Fredericton","Scheffervll","Arvida","Bagottville","Quebec","Sherbrooke","Montreal","Ottawa","Toronto","London","Thunder Bay","Winnipeg","The Pas","Churchill","Regina","Pr. Albert","Uranium City","Edmonton","Calgary","Kamloops","Vancouver","Victoria","Pr. George","Pr. Rupert","Whitehorse","Dawson","Yellowknife","Iqaluit","Inuvik","Resolute"],[0.9938,0.9958,0.9953,0.9959,0.9958,0.9964,0.9973,0.9962,0.9971,0.9972,0.9951,0.9969,0.997,0.9962,0.9963,0.9974,0.9977,0.9981,0.9977,0.9977,0.9979,0.9977,0.9969,0.9947,0.9977,0.9972,0.9957,0.9961,0.9949,0.9963,0.9983,0.9986,0.9975000000000001,0.9981,0.9987],[0.994,0.9959,0.9955000000000001,0.996,0.996,0.9965000000000001,0.9974,0.9962,0.9971,0.9972,0.9952,0.997,0.997,0.9963,0.9964,0.9975000000000001,0.9978,0.9981,0.9977,0.9977,0.9979,0.9978,0.9969,0.9949,0.9977,0.9972,0.9958,0.9961,0.995,0.9964,0.9983,0.9986,0.9976,0.9981,0.9988],[26.6394,24.5922,24.2609,25.3399,26.3954,27.1848,31.338,28.1426,27.5857,26.1916,28.4603,28.033,27.9879,26.0821,26.3292,26.9002,33.0277,34.4905,26.7245,36.8708,36.1481,34.6558,37.2439,37.6531,35.7571,29.6336,28.1596,40.6875,32.6139,35.5339,37.7586,34.3349,28.172,36.6814,28.8121],[37,35,34,38,37,36,39,34,35,33,35,35,36,36,33,34,43,40,34,45,45,41,42,46,41,34,36,46,37,42,43,40,37,42,35]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>City<\/th>\n      <th>R2 I<\/th>\n      <th>R2 II<\/th>\n      <th>Degrees of Freedom<\/th>\n      <th>Non-zero coefficients<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"place","targets":1},{"name":"R2_adjb","targets":2},{"name":"R2_adj","targets":3},{"name":"df","targets":4},{"name":"n_basis","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-canadian-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Some diagnostic values obtained by the application of the ARD procedure, discriminated by city.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="simulation-study-i" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="simulation-study-i">Simulation Study I</h2>
<p>For each simulation study scenario, we replicated <span class="math inline">\(\textbf{R} = 1000\)</span> data sets, obtaining a model for each via Automatic Relevance Determination. Let <span class="math inline">\(K\)</span> denote the number of basis functions, <span class="math inline">\(K_0\)</span> denote the number of non-zero coefficients, <span class="math inline">\(\hat{\beta}_{ijr}(N,n)\)</span> denote the estimated coefficient corresponding to the <span class="math inline">\(j\)</span>-th basis function of the <span class="math inline">\(i\)</span>-th functional observation obtained on the <span class="math inline">\(r\)</span>-th replication of the scenario with number of functional observations <span class="math inline">\(N\)</span> and number of sampled instants <span class="math inline">\(n\)</span> (analogously for <span class="math inline">\(\hat{\tau}_{ir}(N,n)\)</span>) we consider of interest the following measures: <span id="eq-ave-beta"><span class="math display">\[
  \hat{\beta}_{jr}(N,n) = \frac{1}{N}\sum^N_{i = 1}\hat{\beta}_{ijr}(N,n)
\tag{12}\]</span></span> <span id="eq-ave-tau"><span class="math display">\[
  \hat{\tau}_r(N,n) = \frac{1}{N}\sum^N_{i = 1}\hat{\tau}_{ir}(N,n)
\tag{13}\]</span></span> <span id="eq-ave-sen"><span class="math display">\[
  \widehat{\text{SEN}}_r(N,n) = \frac{1}{N (K - K_0)}\Bigg(\sum_{\{(i,j) : \beta_{ij}(n) \neq 0\}}\textbf{1}_{\{0\}^C}(\hat{\beta}_{ijr}(N,n))\Bigg)
\tag{14}\]</span></span></p>
<p><span id="eq-ave-spe"><span class="math display">\[
  \widehat{\text{SPE}}_r(N,n) = \frac{1}{NK_0}\sum_{\{(i,j) : \beta_{ij} = 0\}}\textbf{1}_{\{0\}}(\hat{\beta}_{ijr}(N,n))
\tag{15}\]</span></span> <span id="eq-ave-acc"><span class="math display">\[
  \widehat{\text{ACC}}_r(N,n) = \frac{1}{NK}\Bigg(\sum_{\{(i,j) : \beta_{ij} = 0\}}\textbf{1}_{\{0\}}(\hat{\beta}_{ijr}(N,n)) + \sum_{\{(i,j) : \beta_{ij} \neq 0\}}\textbf{1}_{\{0\}^c}(\hat{\beta}_{ijr}(N,n))\Bigg).
\tag{16}\]</span></span></p>
<p><a href="#eq-ave-beta" class="quarto-xref">Equation&nbsp;12</a> and <a href="#eq-ave-tau" class="quarto-xref">Equation&nbsp;13</a> measure the average values obtained for the <span class="math inline">\(j\)</span>-th coefficient in the basis expansion and the average precision parameter, respectively, for the <span class="math inline">\(r\)</span>-th replication. <a href="#eq-ave-sen" class="quarto-xref">Equation&nbsp;14</a> measures the sensibility (percentage of non-zero coefficients which were estimated as non-zero) of the <span class="math inline">\(r\)</span>-th replication. <a href="#eq-ave-spe" class="quarto-xref">Equation&nbsp;15</a> measures the specificity (percentage of zero coefficients which were estimated as zero) of the <span class="math inline">\(r\)</span>-th -replication. Lastly, <a href="#eq-ave-acc" class="quarto-xref">Equation&nbsp;16</a> measures the overall accuracy of the <span class="math inline">\(r\)</span>-th -replication. The <tt>R</tt> chunk provided below performs <span class="math inline">\(\textbf{R} = 1000\)</span> replications of the nine scenarios for the first Simulation framework. For this simulation we adopted as the cutoff in the ARD procedure the value of <span class="math inline">\(\log_{10} M = 1\)</span>.</p>
<div class="cell fig-cap-location-margin">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb11" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23121998</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>N_sim_1 <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>), <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>n_sim_1 <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df_sim_1 <span class="ot">=</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(N_sim_1),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(q){</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>          N_1 <span class="ot">=</span> N_sim_1[q]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>          n_1 <span class="ot">=</span> n_sim_1[q]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>          t_1 <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n_1)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>          Phi_1 <span class="ot">=</span> <span class="fu">create.bspline.basis</span>(<span class="at">rangeval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">norder =</span> <span class="dv">4</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">nbasis =</span> K_1) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> t_1,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">basisobj =</span> .,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>          mean_1 <span class="ot">=</span> Phi_1 <span class="sc">%*%</span> beta_1</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>          sim_data_total_1 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>replication_1, <span class="at">FUN =</span> <span class="cf">function</span>(z){</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>          sim_data_1 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_1,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                              beta_est <span class="ot">=</span> <span class="fu">numeric</span>(<span class="at">length =</span> K_1)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                              y <span class="ot">=</span> mean_1 <span class="sc">+</span> (tau_1 <span class="sc">**</span> (<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_1)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                              est <span class="ot">=</span> <span class="fu">ard_model</span>(<span class="at">y =</span> y,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">Phi =</span> Phi_1,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">cutoff =</span> <span class="fl">1e1</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                              beta_est[est<span class="sc">$</span>keep] <span class="ot">=</span> est<span class="sc">$</span>beta</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                              sen <span class="ot">=</span> <span class="fu">sum</span>(est<span class="sc">$</span>keep <span class="sc">%in%</span> beta_in_1)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                              spe <span class="ot">=</span> <span class="fu">sum</span>((<span class="dv">1</span><span class="sc">:</span>K_1)[<span class="sc">-</span><span class="fu">c</span>(est<span class="sc">$</span>keep)] <span class="sc">%in%</span> beta_out_1)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                              acc <span class="ot">=</span> sen <span class="sc">+</span> spe</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                              tau_est <span class="ot">=</span> est<span class="sc">$</span>tau</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">return</span>(<span class="fu">c</span>(beta_est <span class="sc">/</span> N_1, tau_est <span class="sc">/</span> N_1, sen, spe, acc))</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                            }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">args =</span> .) <span class="sc">|&gt;</span> <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> sum)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(sim_data_total_1) <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"beta"</span>, K_1),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                                             <span class="dv">1</span><span class="sc">:</span>K_1, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"tau"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"sen"</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"spe"</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"acc"</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        sim_data_total_1 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sen =</span> sen <span class="sc">/</span> (N_1 <span class="sc">*</span> <span class="fu">length</span>(beta_in_1)),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">spe =</span> spe <span class="sc">/</span> (N_1 <span class="sc">*</span> <span class="fu">length</span>(beta_out_1)),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                             <span class="at">acc =</span> acc <span class="sc">/</span> (N_1 <span class="sc">*</span> K_1))</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        sim_data_total_1 <span class="sc">%&lt;&gt;%</span> <span class="fu">melt</span>()</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        sim_data_total_1 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">n =</span> n_1, <span class="at">N =</span> N_1)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(sim_data_total_1)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb12" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_sim_1 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">factor</span>(n), <span class="at">N =</span> <span class="fu">factor</span>(N))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_sim_1 <span class="sc">|&gt;</span> <span class="fu">subset</span>(<span class="fu">grepl</span>(<span class="st">"beta"</span>, variable)) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> N,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Number of sampled instants ("</span>, <span class="fu">italic</span>(n), <span class="st">")"</span>)),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Number of sampled functions ("</span>, <span class="fu">italic</span>(N), <span class="st">")"</span>)),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Estimated"</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-simulation-i-load" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-simulation-i-load-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-simulation-i-load-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-simulation-i-load-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: <span class="math inline">\(N = 100\)</span> functions sampled at <span class="math inline">\(n = 100\)</span> instants according to <a href="#eq-simulation-i" class="quarto-xref">Equation&nbsp;5</a>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_sim_1 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(variable, N, n) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(value), <span class="dv">4</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">median =</span> <span class="fu">round</span>(<span class="fu">median</span>(value), <span class="dv">4</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sd =</span> <span class="fu">round</span>(<span class="fu">sd</span>(value), <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"N"</span>, <span class="st">"n"</span>, <span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"Standard Deviation"</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'variable', 'N'. You can override using the</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-178e3667551c25fa207d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-178e3667551c25fa207d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126"],["beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta10","beta10","beta10","beta10","beta10","beta10","beta10","beta10","beta10","tau","tau","tau","tau","tau","tau","tau","tau","tau","sen","sen","sen","sen","sen","sen","sen","sen","sen","spe","spe","spe","spe","spe","spe","spe","spe","spe","acc","acc","acc","acc","acc","acc","acc","acc","acc"],["10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000"],["10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000"],[-1.9856,-1.9901,-1.9987,-1.9853,-1.99,-1.9989,-1.9838,-1.9902,-1.999,0.1853,-0.0032,0,0.1874,-0.0029,0,0.1863,-0.0028,0,1.33,1.4963,1.4992,1.3263,1.4959,1.4994,1.3283,1.4962,1.4995,1.529,1.4978,1.4998,1.5299,1.4985,1.4999,1.5294,1.4982,1.4998,-0.0012,-0,0,-0.0005,-0.0001,0,-0.0005,-0.0001,0,-0.9149,-1.0062,-1,-0.9143,-1.005,-1,-0.9139,-1.0057,-0.9999,-0.5620000000000001,-0.4742,-0.4987,-0.5642,-0.4761,-0.4989,-0.5633,-0.4755,-0.4989,-0.7751,-1.0073,-0.9995000000000001,-0.7806999999999999,-1.0056,-1.0001,-0.7799,-1.0057,-0.9999,-0.1527,-0.0039,0,-0.1526,-0.0039,0,-0.1542,-0.0041,0,-0.0001,0.001,0,-0,0.0007,0,-0.0002,0.0007,0,73.37520000000001,25.5465,25.0539,65.78060000000001,25.5,25.0482,68.8378,25.5214,25.0518,0.89,0.9903,1,0.8914,0.9905,1,0.8914,0.9903999999999999,1,0.9262,0.994,1,0.926,0.9943,1,0.9258999999999999,0.9942,1,0.9045,0.9918,1,0.9053,0.992,1,0.9052,0.9919,1],[-1.9867,-1.9896,-1.9988,-1.9861,-1.9897,-1.9988,-1.984,-1.9902,-1.999,0.1548,0,0,0.1858,-0.003,0,0.1858,-0.0027,0,1.3382,1.496,1.4994,1.3262,1.4958,1.4993,1.3281,1.4962,1.4995,1.5258,1.4981,1.4999,1.5306,1.4983,1.4999,1.5295,1.4982,1.4998,0,0,0,0,0,0,-0.0004,0,0,-0.918,-1.0055,-1,-0.9137,-1.0052,-1,-0.9137,-1.0056,-0.9999,-0.5643,-0.4787,-0.499,-0.5632,-0.4764,-0.4989,-0.5633,-0.4755,-0.4989,-0.7759,-1.006,-0.9989,-0.7789,-1.0056,-1.0002,-0.7796,-1.0057,-0.9999,-0.1317,0,0,-0.15,-0.0033,0,-0.1539,-0.0041,0,0,0,0,0,0,0,-0,0.0007,0,52.299,25.5068,25.0598,60.5524,25.4984,25.0463,63.88,25.5232,25.0521,0.8833,1,1,0.8917,0.99,1,0.8915,0.9903,1,0.925,1,1,0.9275,0.995,1,0.926,0.9942,1,0.91,0.99,1,0.905,0.992,1,0.9054,0.9919,1],[0.063,0.0422,0.0146,0.0201,0.0124,0.0043,0.0064,0.0039,0.0014,0.1512,0.0124,0,0.0488,0.0036,0,0.0158,0.0011,0,0.1574,0.0357,0.0107,0.0512,0.0115,0.0036,0.0167,0.0037,0.0011,0.1111,0.0298,0.009299999999999999,0.0344,0.0092,0.0029,0.0108,0.0029,0.0009,0.0165,0.0013,0,0.0045,0.0008,0,0.0015,0.0002,0,0.1233,0.034,0.0089,0.0377,0.0105,0.0029,0.0121,0.0034,0.0009,0.1477,0.0498,0.0113,0.0444,0.0157,0.0035,0.014,0.0049,0.0011,0.1727,0.0456,0.012,0.0544,0.0143,0.0037,0.017,0.0044,0.0012,0.1357,0.0113,0,0.0412,0.0037,0,0.013,0.0012,0,0.0112,0.0063,0,0.0037,0.0022,0,0.0011,0.0007,0,231.2603,1.2479,0.3643,39.628,0.3791,0.1122,78.3925,0.1174,0.0349,0.0313,0.0123,0,0.009900000000000001,0.0039,0,0.0028,0.0012,0,0.04,0.0121,0,0.0127,0.0038,0,0.004,0.0012,0,0.0276,0.0086,0,0.008399999999999999,0.0027,0,0.0026,0.0009,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Variable<\/th>\n      <th>N<\/th>\n      <th>n<\/th>\n      <th>Mean<\/th>\n      <th>Median<\/th>\n      <th>Standard Deviation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"variable","targets":1},{"name":"N","targets":2},{"name":"n","targets":3},{"name":"mean","targets":4},{"name":"median","targets":5},{"name":"sd","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="simulation-study-ii" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="simulation-study-ii">Simulation Study II</h2>
<p>The <tt>R</tt> chunk provided below performs <span class="math inline">\(\textbf{R} = 1000\)</span> of the nine scenarios for the second Simulation framework. For this simulation we adopted as the cutoff in the ARD procedure the value of <span class="math inline">\(\log_{10} M = 1\)</span>.</p>
<div class="cell fig-cap-location-margin">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb14" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12231998</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>N_sim_2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>), <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>n_sim_2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_sim_2 <span class="ot">=</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(N_sim_2),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(q){</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>          N_2 <span class="ot">=</span> N_sim_2[q]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>          n_2 <span class="ot">=</span> n_sim_2[q]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>          t_2 <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">length.out =</span> n_2)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>          Phi_2 <span class="ot">=</span> <span class="fu">create.fourier.basis</span>(<span class="at">rangeval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">period =</span> <span class="dv">2</span> <span class="sc">*</span> pi,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">nbasis =</span> K_2) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">getbasismatrix</span>(<span class="at">evalarg =</span> t_2,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">basisobj =</span> .,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nderiv =</span> <span class="dv">0</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>          mean_2 <span class="ot">=</span> <span class="fu">cos</span>(t_2) <span class="sc">+</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> t_2)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>          sim_data_total_2 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>replication_2, <span class="at">FUN =</span> <span class="cf">function</span>(z){</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>          sim_data_2 <span class="ot">=</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>N_2,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                              beta_est <span class="ot">=</span> <span class="fu">numeric</span>(<span class="at">length =</span> K_2)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                              y <span class="ot">=</span> mean_2 <span class="sc">+</span> (tau_2 <span class="sc">**</span> (<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_2)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                              est <span class="ot">=</span> <span class="fu">ard_model</span>(<span class="at">y =</span> y,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">Phi =</span> Phi_2,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">cutoff =</span> <span class="fl">1e1</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>                              beta_est[est<span class="sc">$</span>keep] <span class="ot">=</span> est<span class="sc">$</span>beta</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>                              sen <span class="ot">=</span> <span class="fu">sum</span>(est<span class="sc">$</span>keep <span class="sc">%in%</span> beta_in_2)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                              spe <span class="ot">=</span> <span class="fu">sum</span>((<span class="dv">1</span><span class="sc">:</span>K_2)[<span class="sc">-</span><span class="fu">c</span>(est<span class="sc">$</span>keep)] <span class="sc">%in%</span> beta_out_2)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                              acc <span class="ot">=</span> sen <span class="sc">+</span> spe</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>                              tau_est <span class="ot">=</span> est<span class="sc">$</span>tau</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">return</span>(<span class="fu">c</span>(beta_est <span class="sc">/</span> N_2, tau_est <span class="sc">/</span> N_2, sen, spe, acc))</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>                            }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">args =</span> .) <span class="sc">|&gt;</span> <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> sum)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> .) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(sim_data_total_2) <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"beta"</span>, K_2),</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>                                             <span class="dv">1</span><span class="sc">:</span>K_2, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"tau"</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"sen"</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"spe"</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"acc"</span>)</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        sim_data_total_2 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sen =</span> sen <span class="sc">/</span> (N_2 <span class="sc">*</span> <span class="fu">length</span>(beta_in_2)),</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">spe =</span> spe <span class="sc">/</span> (N_2 <span class="sc">*</span> <span class="fu">length</span>(beta_out_2)),</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                             <span class="at">acc =</span> acc <span class="sc">/</span> (N_2 <span class="sc">*</span> K_2))</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        sim_data_total_2 <span class="sc">%&lt;&gt;%</span> <span class="fu">melt</span>()</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        sim_data_total_2 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">n =</span> n_2, <span class="at">N =</span> N_2)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(sim_data_total_2)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(<span class="at">what =</span> rbind,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb15" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_sim_2 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">factor</span>(n), <span class="at">N =</span> <span class="fu">factor</span>(N))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_sim_2 <span class="sc">|&gt;</span> <span class="fu">subset</span>(<span class="fu">grepl</span>(<span class="st">"beta"</span>, variable)) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> N,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable)) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Number of sampled instants ("</span>, <span class="fu">italic</span>(n), <span class="st">")"</span>)),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="st">"Number of sampled functions ("</span>, <span class="fu">italic</span>(N), <span class="st">")"</span>)),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Estimated"</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family =</span> <span class="st">"LM Roman 10"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">"cm"</span>), </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">ends =</span> <span class="st">"last"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">angle =</span> <span class="dv">30</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">linewidth =</span> .<span class="dv">25</span>),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">linewidth =</span> .<span class="dv">125</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-simulation-ii-load" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-simulation-ii-load-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="ardRepresentation_files/figure-html/fig-simulation-ii-load-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-simulation-ii-load-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: <span class="math inline">\(N = 100\)</span> functions sampled at <span class="math inline">\(n = 100\)</span> instants according to <a href="#eq-simulation-i" class="quarto-xref">Equation&nbsp;5</a>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show <tt>R</tt> code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_sim_2 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(variable, N, n) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(value), <span class="dv">4</span>),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sd =</span> <span class="fu">round</span>(<span class="fu">sd</span>(value), <span class="dv">4</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">median =</span> <span class="fu">round</span>(<span class="fu">median</span>(value), <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"N"</span>, <span class="st">"n"</span>, <span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"Standard Deviation"</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'variable', 'N'. You can override using the</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-537a69bf73d8e1119608" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-537a69bf73d8e1119608">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135"],["beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta1","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta2","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta3","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta4","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta5","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta6","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta7","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta8","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta9","beta10","beta10","beta10","beta10","beta10","beta10","beta10","beta10","beta10","beta11","beta11","beta11","beta11","beta11","beta11","beta11","beta11","beta11","tau","tau","tau","tau","tau","tau","tau","tau","tau","sen","sen","sen","sen","sen","sen","sen","sen","sen","spe","spe","spe","spe","spe","spe","spe","spe","spe","acc","acc","acc","acc","acc","acc","acc","acc","acc"],["10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000","10","10","10","100","100","100","1000","1000","1000"],["10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000","10","100","1000"],[0.0007,0,0,0.0007,0,0,0.0007,0,0,0.0003,0,0,0,0,0,0,0,0,1.7604,1.7714,1.7723,1.759,1.7712,1.7723,1.7592,1.771,1.7723,1.7533,1.7714,1.7724,1.7574,1.7709,1.7723,1.7567,1.771,1.7724,0.0004,0,0,0.0009,0,0,0.0008,0,0,-0,0,0,0,0,0,-0,0,0,0.0007,0,0,0.001,0,0,0.0008,0,0,0,0,0,-0,0,0,0,0,0,0.0001,0,0,0,0,0,0,0,0,-0,0,0,0,0,0,-0,0,0,0.0001,0,0,0,0,0,0,0,0,33.5831,25.4946,25.0651,33.5729,25.5151,25.0495,33.6183,25.5206,25.0522,1,1,1,1,1,1,1,1,1,0.9988,1,1,0.9987,1,1,0.9987,1,1,0.999,1,1,0.9989,1,1,0.999,1,1],[0.0071,0,0,0.0022,0,0,0.0007,0,0,0.0066,0,0,0.0022,0,0,0.0007,0,0,0.0473,0.0161,0.0049,0.0149,0.0049,0.0016,0.0046,0.0016,0.0005,0.0529,0.0157,0.0052,0.0169,0.005,0.0015,0.0056,0.0016,0.0005,0.0061,0,0,0.0022,0,0,0.0007,0,0,0.0075,0,0,0.0024,0,0,0.0007,0,0,0.0059,0,0,0.0022,0,0,0.0007,0,0,0.001,0,0,0.0004,0,0,0.0001,0,0,0.0019,0,0,0.0003,0,0,0.0001,0,0,0.001,0,0,0.0004,0,0,0.0001,0,0,0.0019,0,0,0.0003,0,0,0.0001,0,0,7.5527,1.2158,0.3693,2.3673,0.375,0.111,0.729,0.1164,0.0362,0,0,0,0,0,0,0,0,0,0.0037,0,0,0.0013,0,0,0.0004,0,0,0.003,0,0,0.001,0,0,0.0003,0,0],[0,0,0,0,0,0,0.0005,0,0,0,0,0,0,0,0,0,0,0,1.7593,1.772,1.7721,1.759,1.7712,1.7724,1.7592,1.7711,1.7723,1.7547,1.7708,1.7723,1.7569,1.7709,1.7723,1.7566,1.771,1.7724,0,0,0,0,0,0,0.0008,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0008,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32.6754,25.4535,25.0653,33.3309,25.5104,25.05,33.5677,25.5217,25.0526,1,1,1,1,1,1,1,1,1,1,1,1,0.9989,1,1,0.9988,1,1,1,1,1,0.9991,1,1,0.999,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Variable<\/th>\n      <th>N<\/th>\n      <th>n<\/th>\n      <th>Mean<\/th>\n      <th>Median<\/th>\n      <th>Standard Deviation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"variable","targets":1},{"name":"N","targets":2},{"name":"n","targets":3},{"name":"mean","targets":4},{"name":"sd","targets":5},{"name":"median","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<hr>
</section>
</section>
<section id="concluding-remarks" class="level1">
<h1>Concluding Remarks</h1>
<p><span class="math display">\[
  \begin{aligned}
    y_{i}(t_{ij}) \vert \{\beta_{ki}\}, \tau_i &amp; \sim \text{Normal}\Bigg(\sum^K_{k = 1}\beta_{ki}\textbf{B}_k(t_{ij}), \tau^{-1}_i\Bigg) &amp; i \in \{1,\ldots,N\}, j \in \{1,\ldots,n_i\} \\
    {\beta}_{ki} \vert  \alpha_{ki} &amp; \sim \text{Normal}(0,\alpha_{ki}^{-1}) &amp; k \in \{1,\ldots,K\}, i \in \{1,\ldots,N\} \\
    \alpha_{ki} &amp; \sim \text{Gamma}(a_0, b_0) &amp; k \in \{1,\ldots,K\}, i \in \{1,\ldots,N\} \\
    \tau_i &amp; \sim \text{Gamma}(c_0, d_0) &amp; i \in \{1,\ldots,N\}.
  \end{aligned}
\]</span></p>
<div class="cell" data-output.var="ard_model">
<details class="code-fold">
<summary>Show <tt>stan</tt> code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N; <span class="co">// number of data items</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; K; <span class="co">// dimension of input features</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N,K]   x; <span class="co">// input matrix</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N]     y; <span class="co">// output vector</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// hyperparameters for Gamma priors</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; a0;</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; b0;</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; c0;</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; d0;</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K] b;               <span class="co">// weights (coefficients) vector</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; tau;     <span class="co">// precision</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span> &lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; [K]alpha; <span class="co">// hyper-parameters on weights</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> one_over_tau;</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[K] one_over_alpha; <span class="co">// numerical stability</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  one_over_tau &lt;- <span class="dv">1</span>/tau;</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:K){</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    one_over_alpha[i] &lt;- <span class="dv">1</span>/alpha[i];</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// alpha: hyper-prior on weights</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  alpha ~ gamma(a0, b0);</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">//tau: prior on precision</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  tau ~ gamma(c0, d0);</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">//b: prior on weights</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  b ~ normal(<span class="dv">0</span>, one_over_alpha);</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">//y: likelihood</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  y ~ normal(x * b, one_over_tau);</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="references" class="level1">




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bishop:2006" class="csl-entry" role="listitem">
Bishop, Christopher M. 2006. <em>Pattern Recognition and Machine Learning</em>. Springer.
</div>
<div id="ref-carvalho:2010" class="csl-entry" role="listitem">
Carvalho, Carlos M., Nicholas G. Polson, and James G. Scott. 2010. <span>“The Horseshoe Estimator for Sparse Signals.”</span> <em>Biometrika</em> 97 (2): 465–80. <a href="http://www.jstor.org/stable/25734098">http://www.jstor.org/stable/25734098</a>.
</div>
<div id="ref-daCruz:2024" class="csl-entry" role="listitem">
Cruz, Ana Carolina da, Camila P. E. de Souza, and Pedro H. T. O. Sousa. 2024. <span>“Fast Bayesian Basis Selection for Functional Data Representation with Correlated Errors.”</span> <a href="https://arxiv.org/abs/2405.20758">https://arxiv.org/abs/2405.20758</a>.
</div>
<div id="ref-deBoor:1978" class="csl-entry" role="listitem">
De Boor, Carl. 1978. <em>A Practical Guide to Splines</em>. Vol. 27. Springer New York.
</div>
<div id="ref-fan:2001" class="csl-entry" role="listitem">
Fan, Jianqing, and Runze Li. 2001. <span>“Variable Selection via Nonconcave Penalized Likelihood and Its Oracle Properties.”</span> <em>Journal of the American Statistical Association</em> 96 (456): 1348–60. <a href="https://doi.org/10.1198/016214501753382273">https://doi.org/10.1198/016214501753382273</a>.
</div>
<div id="ref-hastie:1986" class="csl-entry" role="listitem">
Hastie, Trevor, and Robert Tibshirani. 1986. <span>“<span>Generalized Additive Models</span>.”</span> <em>Statistical Science</em> 1 (3): 297–310. <a href="https://doi.org/10.1214/ss/1177013604">https://doi.org/10.1214/ss/1177013604</a>.
</div>
<div id="ref-ramsay:2024" class="csl-entry" role="listitem">
Ramsay, James. 2024. <em>Fda: Functional Data Analysis</em>. <a href="https://CRAN.R-project.org/package=fda">https://CRAN.R-project.org/package=fda</a>.
</div>
<div id="ref-ramsay:2002" class="csl-entry" role="listitem">
Ramsay, James O, and Bernard W Silverman. 2002. <em>Applied Functional Data Analysis: Methods and Case Studies</em>. Springer.
</div>
<div id="ref-silverman:1985" class="csl-entry" role="listitem">
Silverman, B. W. 1985. <span>“Some Aspects of the Spline Smoothing Approach to Non-Parametric Regression Curve Fitting.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 47 (1): 1–21. <a href="https://doi.org/10.1111/j.2517-6161.1985.tb01327.x">https://doi.org/10.1111/j.2517-6161.1985.tb01327.x</a>.
</div>
<div id="ref-sousa:2024" class="csl-entry" role="listitem">
Sousa, Pedro Henrique T. O., Camila P. E. de Souza, and Ronaldo Dias. 2024. <span>“Bayesian Adaptive Selection of Basis Functions for Functional Data Representation.”</span> <em>Journal of Applied Statistics</em> 51 (5): 958–92. <a href="https://doi.org/10.1080/02664763.2023.2172143">https://doi.org/10.1080/02664763.2023.2172143</a>.
</div>
<div id="ref-tibshirani:1996" class="csl-entry" role="listitem">
Tibshirani, Robert. 1996. <span>“Regression Shrinkage and Selection via the Lasso.”</span> <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 58 (1): 267–88. <a href="http://www.jstor.org/stable/2346178">http://www.jstor.org/stable/2346178</a>.
</div>
<div id="ref-tipping:2001" class="csl-entry" role="listitem">
Tipping, Michael E. 2001. <span>“Sparse Bayesian Learning and the Relevance Vector Machine.”</span> <em>J. Mach. Learn. Res.</em> 1 (September): 211–44. <a href="https://doi.org/10.1162/15324430152748236">https://doi.org/10.1162/15324430152748236</a>.
</div>
<div id="ref-venables:2002" class="csl-entry" role="listitem">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with s</em>. Fourth. New York: Springer. <a href="https://www.stats.ox.ac.uk/pub/MASS4/">https://www.stats.ox.ac.uk/pub/MASS4/</a>.
</div>
<div id="ref-xian:2024" class="csl-entry" role="listitem">
Xian, Chengqian, Camila P. E. de Souza, John Jewell, and Ronaldo Dias. 2024. <span>“Clustering Functional Data via Variational Inference.”</span> <em>Advances in Data Analysis and Classification</em>. <a href="https://doi.org/10.1007/s11634-024-00590-w">https://doi.org/10.1007/s11634-024-00590-w</a>.
</div>
<div id="ref-zhang:2010" class="csl-entry" role="listitem">
Zhang, Cun-Hui. 2010. <span>“<span class="nocase">Nearly unbiased variable selection under minimax concave penalty</span>.”</span> <em>The Annals of Statistics</em> 38 (2): 894–942. <a href="https://doi.org/10.1214/09-AOS729">https://doi.org/10.1214/09-AOS729</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We avoid denoting the accelerometer measurements as <span class="math inline">\(y(t_j)\)</span> since, as stated, there are measurement times <span class="math inline">\(t_j\)</span> which appear repeatedly, with distinct <span class="math inline">\(y_j\)</span>, such that writing <span class="math inline">\(y(t_j) = y_j\)</span> would result in inconsistencies. The same is true for the random variables from which these observations are drawn, which we denote as <span class="math inline">\(Y_j\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The equivalency between <a href="#eq-expectation" class="quarto-xref">Equation&nbsp;1</a> and <a href="#eq-decomposition" class="quarto-xref">Equation&nbsp;2</a> is a consequence of the assumption of normality for the random errors in <a href="#eq-decomposition" class="quarto-xref">Equation&nbsp;2</a> (although this equivalency would hold so long as <span class="math inline">\(\varepsilon_j\)</span> had mean zero). The form in <a href="#eq-decomposition" class="quarto-xref">Equation&nbsp;2</a> is more appealing due to its inherent distinction between the deterministic and stochastic components, however, the formulation in <a href="#eq-expectation" class="quarto-xref">Equation&nbsp;1</a> (coupled with distributional assumptions on <span class="math inline">\(Y_j\)</span>) is adopted under the generic framework of ‘<em>generalized linear models</em>’ (or particularly, for function estimation, the framework of ‘<em>generalized additive models</em>’; see <span class="citation" data-cites="hastie:1986">Hastie and Tibshirani (<a href="#ref-hastie:1986" role="doc-biblioref">1986</a>)</span>).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This behavior is expected: as the object is approximately inert prior to the impact, likewise, in the immediate milliseconds following impact, it is approximately inert, eventually gaining acceleration, which dissipates as time passes, and the object eventually returns to inertia.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Unlike the Motorcycle data set, for any fixed city <span class="math inline">\(i\)</span> in the Canadian weather data set, the observation instants do not repeat and are all equally spaced. Also importantly, they are the same across all cities (that is, <span class="math inline">\(t_{ij} = t_j, \forall i \in \{1,\ldots,N\}\)</span>). This likewise implies that the matrix <span class="math inline">\(\boldsymbol{\Phi}_i\)</span> defined later is the same independent of the subscript <span class="math inline">\(i\)</span>. We opt to not remove the subscript in this data set to preserve the generality of the content. When the observation instants satisfy these conditions, the sampling design is said to be regular.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>However, it’s expected that some mean temperature functions present roughly similar behavior due to geographical proximity and climate similarity of the corresponding cities. These similarities have been studied in applications in functional data clustering, as seen in <span class="citation" data-cites="xian:2024">Xian et al. (<a href="#ref-xian:2024" role="doc-biblioref">2024</a>)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../404.html">
<div id="output">

</div>
<div id="person">

</div>
<script src="index.js"></script>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>